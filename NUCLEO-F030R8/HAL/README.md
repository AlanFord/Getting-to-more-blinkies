# Getting to Blinky with HAL

Several options are available for the toolchain.

First, a commercial IDE such as KEIL can be used, albiet the free, hobbled version.

A relatively turnkey alternative is to use the SystemWorkbench, 
see http://www.openstm32.org/Importing%2Ba%2BSTCubeMX%2Bgenerated%2Bproject
If a generic board setup isn't used, a more detailed configuration can be generated
with the ST32CubeMX application for use with SystemWorkbench.

More broadly, a pretty generic, open source toolchain and IDE can be configured using Eclipse and a Gnu ARM toolchain.

But I'm going another direction.  There is now a free-to-use IDE from STMicro called Atollic TrueSTUDIO for STM32.
After installing in a Linux VM, install TrueSTUDIO.  That's it!  TrueSTUDIO comes with a full toochain and device files.

A new project was created using the "Embedded C Project" Project Type.  The Target was set to the
NUCLEO-F030R8 board (under the STM32F0 device category).  Debugging with ST-LINK is the
only option supported, so we are using that.

The generic files generated by the IDE for a new project include "main.c", which already includes
code for toggling the on-board LED.
```
/* -3- Toggle IOs in an infinite loop */
while (1)
{
    HAL_GPIO_TogglePin(LED2_GPIO_PORT, LED2_PIN);
    /* Insert delay 100 ms */
    HAL_Delay(100);
}
```
The on-board user LED (LED2) is connected to connector CN5, pin 6, also known as Arduino
pin D13 and STM32 pin PA5.  For this work we will use CN5 pin 5 (Arduino pin D12 and
STM32 pin PA6).  Hence, the code is changed to:
```
/* -3- Toggle IOs in an infinite loop */
while (1)
{
    HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_6);
    /* Insert delay 1000 ms */
    HAL_Delay(1000);
}
```
One other statement should also be changed.  The original code enables the clock for the on-board LED
gpio pin using the statement
```
LED2_GPIO_CLK_ENABLE();
```
As we are using pin PA6 in lieu of LED2, the statement is changed to
```
__HAL_RCC_GPIOA_CLK_ENABLE();
```
This makes the code cleaner, but wasn't really necessary, as LED2 is also on GPIOA and the two statements
are functionally identical.

## Getting it on the Nucleo Board

The project configuration built by TrueStudio can be a little sparse, not really configured for getting your
software onto the board, but that can be fixed.  Copying the software to the USB-mounted board can be 
done if you have a hex file.  To get a hex file, add the following line as a post-build step in the project
build settings under "C/C++Build-->Settings":
```
arm-atollic-eabi-objcopy -O ihex "${BuildArtifactFileBaseName}.elf" "${BuildArtifactFileBaseName}.hex"
```
This hex file can be copied to the Nucleo board for programming. 

For debugging, a Debug Configuration should be configured.  The easiest way is to copy one that works from an existing
project, changing the Name, C/C++ Application, and Project fields on the "Main" tab.  Also kick over to the 
"Common" tab and change the folder name in the "Save as Shared file" field, if it's used.

